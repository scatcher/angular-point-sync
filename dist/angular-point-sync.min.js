"use strict";angular.module("angularPoint").factory("apSyncService",["$q","$timeout","$firebase","apConfig",function(a,b,c,d){function e(a,b){return new f(a,b)}var f=function(a,b){var e=this;e.updateQuery=b,e.changeNotifier=new Firebase(d.firebaseURL+"/changes/"+a.list.title),e.lastUpdate=c(e.changeNotifier),e.registerChange=function(){console.log("Change detected in "+a.list.title+" list.");var b=Firebase.ServerValue.TIMESTAMP;e.changeCount=0,e.lastUpdate.$set(b)},e.subscriptions=[],e.changeCount=0,e.processChanges=function(){e.changeCount>0&&_.each(e.subscriptions,function(a){console.log("Processing callback"),_.isFunction(a)&&a()}),e.changeCount+=1},e.throttleRequests=_.throttle(function(){return e.processChanges()},1e3,{leading:!1}),e.lastUpdate.$on("change",function(){e.throttleRequests()}),e.subscribeToChanges=function(a){-1===e.subscriptions.indexOf(a)&&e.subscriptions.push(a)}};return{synchronizeData:e}}]);